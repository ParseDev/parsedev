<%= form_with model: Dataquery.new, url: dataqueries_path, method: :post, remote: true, data: {disabled_with: 'Saving ...'}, html: {data: {turbo: false}} do |form| %>
  <%= form.hidden_field :datasource_id, value: prompt.datasource_id %>
  <%= form.hidden_field :user_id, value: current_user.id %>
  <%= form.hidden_field :query, value: prompt.code %>
  <%= form.hidden_field :name, value: prompt.content %>
  <%= form.button 'Save', class: 'bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded cursor-pointer' %>
  <%= form.button 'Edit', class: 'bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded cursor-pointer' %>
<% end %>

<div class="w-full overflow-x-scroll mt-10">
  <% if result && !result.is_a?(String) && result.added_context.is_a?(Hash) && result.added_context.key?(:code) %>
    <code class="bg-gray-800 text-white p-3 rounded-md whitespace-pre-line block">
      <%= prompt.sanitized_code %>
    </code>
  <% elsif result.is_a?(String) %>
    <%= result %>
  <% else %>
    <p> Oops, it seems like something went wrong </p>
  <% end %>
</div>

<% if result.present? && result.try(:answer).present? && result.answer.kind_of?(Array) %>
<div class="px-4 sm:px-6 lg:px-8">
  <div class="mt-8 flow-root">
    <%= render "shared/result_table", answer: result.answer, prompt: prompt, include_save_button: true, include_create_chart_button: true %>
  </div>
</div>

<% else %>
<div class="mt-10">
  <div class="p-3 rounded-md">
    Response
  </div>
  <% render "shared/code", code: result %>


</div>

<% end %>



